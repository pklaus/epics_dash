{% extends "base_bootstrap.jinja2" %}

{% block title %}{{ config.pages[req_page].name }}{% endblock %}

{% block header %}
<meta http-equiv="refresh" content="15">
<link rel="stylesheet" href="/static/css/sparkline.css">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="/static/js/sparkline.js"></script>
<style>
.pv-block {
  border-radius: 10px;
  border: 1.5px solid #ddd;
  margin-bottom: 20px;
  padding: 10px;
}
</style>
{% endblock %}

{% block content %}
		<div id="PVs">
			{% set page = config.pages[req_page] %}
			{% for group in page.groups %}
			{% set this_group = config.groups[group] %}
			<div id="{{ this_group.name }}">
				<h2>{{ this_group.name }}</h2>
				{% for pv_name in this_group.PVs %}
				{% set PV = config.PVs[config.PV_lookup[pv_name]] %}
				{% if loop.index0 % 3 == 0 %}
				<div class="row">
				{% endif %}
					<div class="col-md-4">
					<div class="pv-block value indicator {{ PV.classes }}" style="cursor: pointer;" title="{{ PV.alias }}">
						<div class="error"></div>
						<div class="pvname">{{ PV.name }}</div>
						<div class="value-unit-box">
							<span class="value">
							{% if 'switch' in PV.classes %}
								<label class="toggle">
									<input type="checkbox" disabled readonly {{ 'checked' if 'ON' in PV.value else '' }}>
									<span data-unchecked="OFF" data-checked="ON"></span>
								</label>
							{% else %}
                                                		{% if PV.precision is number %}
									{{ ("%."+PV.precision|string +"f") % PV.value }}
								{% else %}
									{{ PV.value }}
								{% endif %}
							{% endif %}
							</span>
							<span class="unit">{{ PV.unit }}</span>
						</div>
						<div id="sparkline-{{ PV.name|replace(':','-') }}" class="sparkline"></div></td>
                                	</div>
                                	</div>
				{% if (loop.index0 % 3 == 2) or loop.last %}
				</div>
				{% endif %}
				{% endfor %}
			</div>
			{% endfor %}
		</div>
{% endblock %}


{% block js_end_of_page %}
/*
$(function() {
  // on page load
  updateSparklines();
});
*/
updateSparklines();
{% endblock %}
